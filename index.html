<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Викторина "Угадай растение"</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const PlantQuizGame = () => {
        // Данные растений с локализацией и специфическими неправильными ответами
            const plantsDatabase = [
                { 
                    id: 1, 
                    image: "images/BeachDaisy.JPG",
                    names: {
                        ru: "Астерискус приморский",
                        en: "Beach Daisy",
                        sci: "Asteriscus maritimus"
                    },
                    wrongAnswers: [7, 8, 9]
                },
                { 
                    id: 2, 
                    image: "images/MoonCarrot.JPG",
                    names: {
                        ru: "Дикая морковь",
                        en: "Sea Carrot",
                        sci: "Daucus carota"
                    },
                    wrongAnswers: [10, 11, 12]
                },
                { 
                    id: 3, 
                    image: "images/Agapanthus.JPG",
                    names: {
                        ru: "Агапантус",
                        en: "Agapanthus",
                        sci: "Agapanthus africanus"
                    },
                    wrongAnswers: [13, 14, 15, 16]
                },
                { 
                    id: 4, 
                    image: "images/bougainvillea.JPG",
                    names: {
                        ru: "Бугенвиллея",
                        en: "Bougainvillea",
                        sci: "Bougainvillea spectabilis"
                    },
                    wrongAnswers: [17, 18, 19, 20]
                },
                { 
                    id: 5, 
                    image: "images/camelia.JPG",
                    names: {
                        ru: "Камелия",
                        en: "Camellia",
                        sci: "Camellia japonica"
                    },
                    wrongAnswers: [20, 21, 22, 23, 24]
                },
                { 
                    id: 6, 
                    image: "images/Gerbera.JPG",
                    names: {
                        ru: "Гербера",
                        en: "Gerbera",
                        sci: "Gerbera jamesonii"
                    },
                    wrongAnswers: [25, 26, 27, 28, 29]
                },
                {
                    id: 30,
                    image: "images/Osteospermum.JPG",
                    names: { 
                        ru: "Остеоспермум", 
                        en: "African Daisy", 
                        sci: "Osteospermum" 
                    },
                    wrongAnswers: [31, 32, 33]
                },
                {
                    id: 31, 
                    image: "images/Rose.JPG",
                    names: { 
                        ru: "Роза", 
                        en: "Rose", 
                        sci: "Rosa" 
                    },
                    wrongAnswers: [32, 33, 34, 35]
                },
                {
                    id: 32, 
                    image: "images/Guzmania.JPG",
                    names: { 
                        ru: "Гузмания", 
                        en: "Scarlet Star", 
                        sci: "Guzmania lingulata" 
                    },
                    wrongAnswers: [30, 31, 33, 34]
                },
                {
                    id: 33, 
                    image: "images/Poppy.JPG",
                    names: { 
                        ru: "Мак", 
                        en: "Poppy", 
                        sci: "Papaver" 
                    },
                    wrongAnswers: [31, 32, 34, 35]
                },
                {                    
                    id: 34, 
                    image: "images/Pohutukawa.JPG",
                    names: { 
                        ru: "Похутукава", 
                        en: "Pohutukawa", 
                        sci: "Metrosideros excelsa" 
                    },
                    wrongAnswers: [30, 31, 32, 35]
                },
                {                     
                    id: 35, 
                    image: "images/Lily.JPG",
                    names: { 
                        ru: "Лилия", 
                        en: "Lily", 
                        sci: "Lilium" 
                    },
                    wrongAnswers: [30, 31, 33, 34]
                }
            ];

            // Словарь всех возможных названий растений (включая неправильные варианты)
            const namesDatabase = {
                1: { ru: "Астерискус приморский", en: "Beach Daisy", sci: "Asteriscus maritimus" },
                2: { ru: "Дикая морковь", en: "Sea Carrot", sci: "Daucus carota" },
                3: { ru: "Агапантус", en: "Agapanthus", sci: "Agapanthus africanus" },
                4: { ru: "Бугенвиллия", en: "Bougainvillea", sci: "Bougainvillea spectabilis" },
                5: { ru: "Камелия", en: "Camellia", sci: "Camellia japonica" },
                6: { ru: "Гербера", en: "Gerbera", sci: "Gerbera jamesonii" },
                // Дополнительные неправильные варианты
                7: { ru: "Арктотека ноготковая", en: "Cape Weed", sci: "Arctotheca calendula" },
                8: { ru: "Гацания", en: "Gazania", sci: "Gazania" },
                9: { ru: "Лампрантус золотой", en: "Golden Ice Plant", sci: "Lampranthus aureus" },
                10: { ru: "Борщевик", en: "Hogweed", sci: "Heracleum" },
                11: { ru: "Дудник лесной", en: "Wild Parsley", sci: "Angelica sylvestris" },
                12: { ru: "Пастернак", en: "Parsnip", sci: "Pastinaca sativa" },
                13: { ru: "Лук гигантский", en: "Giant Allium", sci: "Allium giganteum" },
                14: { ru: "Камассия", en: "Camas", sci: "Camassia" },
                15: { ru: "Глобулярия", en: "Globe Daisy", sci: "Globularia" },
                16: { ru: "Рябчик", en: "Fritillary", sci: "Fritillaria" },
                17: { ru: "Клематис", en: "Clematis", sci: "Clematis" },
                18: { ru: "Глициния", en: "Wisteria", sci: "Wisteria" },
                19: { ru: "Олеандр", en: "Oleander", sci: "Nerium oleander" },
                20: { ru: "Азалия", en: "Azalea", sci: "Rhododendron" },
                21: { ru: "Рододендрон", en: "Rhododendron", sci: "Rhododendron" },
                22: { ru: "Роза", en: "Rose", sci: "Rosa" },
                23: { ru: "Гардения", en: "Gardenia", sci: "Gardenia" },
                24: { ru: "Магнолия", en: "Magnolia", sci: "Magnolia" },
                25: { ru: "Нивяник", en: "Shasta Daisy", sci: "Leucanthemum x superbum" },
                26: { ru: "Георгин", en: "Dahlia", sci: "Dahlia" },
                27: { ru: "Эхинацея", en: "Coneflower", sci: "Echinacea" },
                28: { ru: "Арктотис", en: "African Daisy", sci: "Arctotis" },
                29: { ru: "Хризантема крупноцветковая", en: "Max Chrysanthemum", sci: "Chrysanthemum maximum" },
                // Новые растения
                30: { ru: "Остеоспермум", en: "African Daisy", sci: "Osteospermum" },
                31: { ru: "Роза", en: "Rose", sci: "Rosa" },
                32: { ru: "Гузмания", en: "Scarlet Star", sci: "Guzmania lingulata" },
                33: { ru: "Мак", en: "Poppy", sci: "Papaver" },
                34: { ru: "Похутукава", en: "Pohutukawa", sci: "Metrosideros excelsa" },
                35: { ru: "Лилия", en: "Lily", sci: "Lilium" }
            };

            // Тексты интерфейса с локализацией
            const uiTexts = {
                ru: {
                    question: "Что это за растение?",
                    score: "Баллы",
                    correct: "Верно!",
                    incorrect: "Неверно!",
                    result: "Вы получили",
                    resultPoints: "баллов",
                    playAgain: "Играть снова",
                    instruction: "Выберите правильное название растения",
                    continue: "Продолжить",
                    sessionComplete: "Сессия завершена!",
                    sessionScore: "Баллы за сессию",
                    totalScore: "Всего баллов",
                    firstGame: "Первая игра",
                    secondGame: "Вторая игра",
                    resetProgress: "Сбросить прогресс",
                    session: "Сессия"
                },
                en: {
                    question: "What plant is this?",
                    score: "Score",
                    correct: "Correct!",
                    incorrect: "Incorrect!",
                    result: "You scored",
                    resultPoints: "points",
                    playAgain: "Play Again",
                    instruction: "Choose the correct plant name",
                    continue: "Continue",
                    sessionComplete: "Session Complete!",
                    sessionScore: "Session Score",
                    totalScore: "Total Score",
                    firstGame: "First Game",
                    secondGame: "Second Game",
                    resetProgress: "Reset Progress",
                    session: "Session"
                },
                sci: {
                    question: "Quae planta est?",
                    score: "Score",
                    correct: "Recte!",
                    incorrect: "Perperam!",
                    result: "Score",
                    resultPoints: "points",
                    playAgain: "Ludere iterum",
                    instruction: "Choose the correct scientific name",
                    continue: "Continuare",
                    sessionComplete: "Sessio completa!",
                    sessionScore: "Sessio Score",
                    totalScore: "Summa Score",
                    firstGame: "Prima ludus",
                    secondGame: "Secunda ludus",
                    resetProgress: "Reset progressus",
                    session: "Sessio"
                }
            };

            // Функция для работы с localStorage
            const loadFromStorage = (key, defaultValue) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                    return defaultValue;
                }
            };

            const saveToStorage = (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                }
            };

            // Состояния
            const [language, setLanguage] = useState(() => loadFromStorage('plantQuizLanguage', 'ru'));
            const [currentSession, setCurrentSession] = useState(() => loadFromStorage('plantQuizCurrentSession', 1));
            const [usedPlantIds, setUsedPlantIds] = useState(() => loadFromStorage('plantQuizUsedPlants', []));
            const [sessionScores, setSessionScores] = useState(() => loadFromStorage('plantQuizSessionScores', { 1: 0, 2: 0 }));
            const [plantsOrder, setPlantsOrder] = useState([]);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [currentSessionScore, setCurrentSessionScore] = useState(0);
            const [gameState, setGameState] = useState('playing'); // playing, correct, incorrect, sessionEnd, allComplete
            const [optionIds, setOptionIds] = useState([]);
            const [correctAnswerId, setCorrectAnswerId] = useState(null);

            // Сохранение состояний в localStorage при изменении
            useEffect(() => {
                saveToStorage('plantQuizLanguage', language);
            }, [language]);

            useEffect(() => {
                saveToStorage('plantQuizCurrentSession', currentSession);
            }, [currentSession]);

            useEffect(() => {
                saveToStorage('plantQuizUsedPlants', usedPlantIds);
            }, [usedPlantIds]);

            useEffect(() => {
                saveToStorage('plantQuizSessionScores', sessionScores);
            }, [sessionScores]);

            // Функция перемешивания массива
            const shuffleArray = (array) => {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            };

            // Функция генерации ID вариантов ответов для растения
            const generateOptionIds = (plant) => {
                const correctId = plant.id;
                let wrongIds = [];

                if (plant.wrongAnswers && plant.wrongAnswers.length > 0) {
                    if (plant.wrongAnswers.length > 3) {
                        const shuffled = shuffleArray(plant.wrongAnswers);
                        wrongIds = shuffled.slice(0, 3);
                    } else {
                        wrongIds = [...plant.wrongAnswers];
                    }

                    if (wrongIds.length < 3) {
                        const allIds = Object.keys(namesDatabase).map(id => parseInt(id));
                        const availableIds = allIds.filter(id => 
                            id !== correctId && !wrongIds.includes(id)
                        );
                        const shuffled = shuffleArray(availableIds);
                        
                        while (wrongIds.length < 3 && shuffled.length > 0) {
                            wrongIds.push(shuffled.shift());
                        }
                    }
                } else {
                    const allIds = Object.keys(namesDatabase).map(id => parseInt(id));
                    const availableIds = allIds.filter(id => id !== correctId);
                    const shuffled = shuffleArray(availableIds);
                    wrongIds = shuffled.slice(0, 3);
                }

                return shuffleArray([correctId, ...wrongIds]);
            };

            // Инициализация новой сессии
            const initializeSession = () => {
                // Получаем растения, которые еще не были показаны
                const availablePlants = plantsDatabase.filter(plant => !usedPlantIds.includes(plant.id));
                
                // Если доступных растений меньше 6, значит все растения уже были показаны
                if (availablePlants.length < 6) {
                    // Сбрасываем использованные растения и начинаем заново
                    setUsedPlantIds([]);
                    const shuffled = shuffleArray(plantsDatabase).slice(0, 6);
                    setPlantsOrder(shuffled);
                    // Добавляем ID новых растений к использованным
                    const newUsedIds = shuffled.map(p => p.id);
                    setUsedPlantIds(newUsedIds);
                } else {
                    // Выбираем 6 случайных растений из доступных
                    const shuffled = shuffleArray(availablePlants).slice(0, 6);
                    setPlantsOrder(shuffled);
                    // Добавляем ID новых растений к использованным
                    setUsedPlantIds([...usedPlantIds, ...shuffled.map(p => p.id)]);
                }
                
                setCurrentQuestion(0);
                setCurrentSessionScore(0);
                setGameState('playing');
            };

            // Инициализация при первой загрузке
            useEffect(() => {
                // Проверяем, есть ли сохраненное состояние
                if (currentSession > 2) {
                    // Если обе сессии уже завершены, показываем финальный экран
                    setGameState('allComplete');
                } else {
                    initializeSession();
                }
            }, []);

            // Генерация вариантов ответов при смене вопроса
            useEffect(() => {
                if (plantsOrder.length > 0 && currentQuestion < plantsOrder.length) {
                    const currentPlant = plantsOrder[currentQuestion];
                    
                    if (gameState === 'playing' || currentQuestion === 0) {
                        const newOptionIds = generateOptionIds(currentPlant);
                        setOptionIds(newOptionIds);
                        setCorrectAnswerId(currentPlant.id);
                    }
                }
            }, [currentQuestion, plantsOrder]);

            // Обработка ответа
            const handleAnswer = (selectedId) => {
                if (selectedId === correctAnswerId) {
                    setCurrentSessionScore(currentSessionScore + 1);
                    setGameState('correct');
                } else {
                    setGameState('incorrect');
                }

                setTimeout(() => {
                    if (currentQuestion + 1 < plantsOrder.length) {
                        setCurrentQuestion(currentQuestion + 1);
                        setGameState('playing');
                    } else {
                        // Сохраняем результат текущей сессии
                        const newSessionScores = { ...sessionScores };
                        newSessionScores[currentSession] = currentSessionScore + (selectedId === correctAnswerId ? 1 : 0);
                        setSessionScores(newSessionScores);
                        
                        if (currentSession === 1) {
                            // Завершена первая сессия
                            setGameState('sessionEnd');
                        } else {
                            // Завершены обе сессии
                            setGameState('allComplete');
                        }
                    }
                }, 1500);
            };

            // Продолжить к следующей сессии
            const continueToNextSession = () => {
                setCurrentSession(2);
                initializeSession();
            };

            // Полный сброс игры
            const fullReset = () => {
                setCurrentSession(1);
                setUsedPlantIds([]);
                setSessionScores({ 1: 0, 2: 0 });
                setCurrentSessionScore(0);
                setCurrentQuestion(0);
                initializeSession();
            };

            // Сброс прогресса
            const resetProgress = () => {
                if (confirm(language === 'ru' ? 'Вы уверены, что хотите сбросить весь прогресс?' : 
                           language === 'en' ? 'Are you sure you want to reset all progress?' : 
                           'Certus es te velle reset progressum?')) {
                    // Очищаем localStorage
                    localStorage.removeItem('plantQuizUsedPlants');
                    localStorage.removeItem('plantQuizSessionScores');
                    localStorage.removeItem('plantQuizCurrentSession');
                    
                    fullReset();
                }
            };

            // Изменение языка
            const changeLanguage = (newLang) => {
                setLanguage(newLang);
            };

            // Получение изображения растения
            const getPlantImage = (plantData) => {
                if (plantData.image.startsWith('images/')) {
                    return React.createElement('img', {
                        key: 'plant-image',
                        src: plantData.image,
                        alt: `Растение ${plantData.id}`,
                        className: 'w-full h-full object-cover',
                        style: { 
                            border: '6px solid #C29C27'
                        }
                    });
                }
                return null;
            };

            const texts = uiTexts[language];
            const totalScore = sessionScores[1] + sessionScores[2];

            // Экран завершения сессии
            if (gameState === 'sessionEnd') {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center relative',
                    style: { backgroundColor: '#163B3A' }
                }, [
                    // Декоративные золотые полоски
                    React.createElement('div', { key: 'decor1', className: 'absolute top-4 left-4 w-20 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor2', className: 'absolute top-8 left-8 w-32 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor3', className: 'absolute bottom-4 right-4 w-20 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor4', className: 'absolute bottom-8 right-8 w-32 h-1', style: { backgroundColor: '#C29C27' } }),
                    
                    React.createElement('div', {
                        key: 'result',
                        className: 'p-8 shadow-lg text-center max-w-md mx-4',
                        style: { backgroundColor: '#163B3A', border: '6px solid #C29C27' }
                    }, [
                        React.createElement('h1', {
                            key: 'title',
                            className: 'text-3xl font-bold mb-4',
                            style: { color: '#C29C27' }
                        }, texts.sessionComplete),
                        React.createElement('p', {
                            key: 'session-score',
                            className: 'text-2xl mb-6',
                            style: { color: '#C29C27' }
                        }, `${texts.sessionScore}: ${sessionScores[1]}/6`),
                        React.createElement('button', {
                            key: 'continue',
                            onClick: continueToNextSession,
                            className: 'px-6 py-3 font-semibold text-white transition-colors hover:opacity-80',
                            style: { backgroundColor: '#163B3A', border: '4px solid #C29C27', color: '#C29C27' }
                        }, texts.continue)
                    ])
                ]);
            }

            // Экран завершения всех сессий
            if (gameState === 'allComplete') {
                return React.createElement('div', {
                    className: 'min-h-screen flex items-center justify-center relative',
                    style: { backgroundColor: '#163B3A' }
                }, [
                    // Декоративные золотые полоски
                    React.createElement('div', { key: 'decor1', className: 'absolute top-4 left-4 w-20 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor2', className: 'absolute top-8 left-8 w-32 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor3', className: 'absolute bottom-4 right-4 w-20 h-1', style: { backgroundColor: '#C29C27' } }),
                    React.createElement('div', { key: 'decor4', className: 'absolute bottom-8 right-8 w-32 h-1', style: { backgroundColor: '#C29C27' } }),
                    
                    React.createElement('div', {
                        key: 'result',
                        className: 'p-8 shadow-lg text-center max-w-2xl mx-4',
                        style: { backgroundColor: '#163B3A', border: '6px solid #C29C27' }
                    }, [
                        React.createElement('h1', {
                            key: 'total-title',
                            className: 'text-4xl font-bold mb-8',
                            style: { color: '#C29C27' }
                        }, `${texts.totalScore}: ${totalScore}/12`),
                        
                        React.createElement('div', {
                            key: 'scores-container',
                            className: 'grid grid-cols-2 gap-8 mb-8'
                        }, [
                            React.createElement('div', {
                                key: 'first-game',
                                className: 'p-4',
                                style: { backgroundColor: '#163B3A', border: '3px solid #C29C27' }
                            }, [
                                React.createElement('h3', {
                                    key: 'first-title',
                                    className: 'text-xl font-bold mb-2',
                                    style: { color: '#C29C27' }
                                }, texts.firstGame),
                                React.createElement('p', {
                                    key: 'first-score',
                                    className: 'text-2xl',
                                    style: { color: '#C29C27' }
                                }, `${sessionScores[1]}/6`)
                            ]),
                            
                            React.createElement('div', {
                                key: 'second-game',
                                className: 'p-4',
                                style: { backgroundColor: '#163B3A', border: '3px solid #C29C27' }
                            }, [
                                React.createElement('h3', {
                                    key: 'second-title',
                                    className: 'text-xl font-bold mb-2',
                                    style: { color: '#C29C27' }
                                }, texts.secondGame),
                                React.createElement('p', {
                                    key: 'second-score',
                                    className: 'text-2xl',
                                    style: { color: '#C29C27' }
                                }, `${sessionScores[2]}/6`)
                            ])
                        ]),
                        
                        React.createElement('button', {
                            key: 'restart',
                            onClick: fullReset,
                            className: 'px-6 py-3 font-semibold text-white transition-colors hover:opacity-80',
                            style: { backgroundColor: '#163B3A', border: '4px solid #C29C27', color: '#C29C27' }
                        }, texts.playAgain)
                    ])
                ]);
            }

            // Основной экран игры
            return React.createElement('div', {
                className: 'min-h-screen p-4 relative flex flex-col',
                style: { backgroundColor: '#163B3A' }
            }, [
                // Декоративные золотые полоски
                React.createElement('div', { key: 'decor1', className: 'absolute top-4 left-4 w-24 h-1', style: { backgroundColor: '#C29C27' } }),
                React.createElement('div', { key: 'decor2', className: 'absolute top-8 left-8 w-40 h-1', style: { backgroundColor: '#C29C27' } }),
                React.createElement('div', { key: 'decor3', className: 'absolute top-12 left-12 w-16 h-1', style: { backgroundColor: '#C29C27' } }),
                React.createElement('div', { key: 'decor4', className: 'absolute bottom-4 right-4 w-24 h-1', style: { backgroundColor: '#C29C27' } }),
                React.createElement('div', { key: 'decor5', className: 'absolute bottom-8 right-8 w-40 h-1', style: { backgroundColor: '#C29C27' } }),
                React.createElement('div', { key: 'decor6', className: 'absolute bottom-12 right-12 w-16 h-1', style: { backgroundColor: '#C29C27' } }),
                
                React.createElement('div', {
                    key: 'container',
                    className: 'w-full max-w-5xl mx-auto relative z-10 flex-1 flex flex-col justify-center'
                }, [
                    // Заголовок со счетчиками и языковыми кнопками
                    React.createElement('div', {
                        key: 'header',
                        className: 'flex justify-between items-center mb-6'
                    }, [
                        React.createElement('div', {
                            key: 'progress',
                            className: 'flex flex-col',
                            style: { color: '#C29C27' }
                        }, [
                            React.createElement('span', {
                                key: 'session-label',
                                className: 'text-sm font-bold'
                            }, `${texts.session} ${currentSession}`),
                            React.createElement('span', {
                                key: 'question-progress',
                                className: 'text-2xl font-bold'
                            }, `${currentQuestion + 1}/6`)
                        ])
