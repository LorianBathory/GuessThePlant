# Конвертер PlantData ⇄ CSV

Этот документ объясняет, как использовать скрипт `tools/plantDataConverter.mjs`, который преобразует файл `PlantData.json` в удобный для редактирования CSV и обратно. Инструкция рассчитана на людей без опыта работы с конвертерами и описывает процесс шаг за шагом.

## Что делает скрипт

- **to-csv**: собирает сведения о растениях (названия на разных языках, научное название, семейство, изображения и сложности вопросов) и выгружает их в CSV по образцу `docs/sample.csv`.
- **to-json**: считывает такой CSV и формирует новый `PlantData.json` с полями, которые нужны игре (`plantNames`, `species`, `plantQuestions`, `plantImages`, `plantParameters`, `plantFamilies`, `difficulties`). Остальные разделы (`bouquetQuestions`, `genus`) заполняются пустыми массивами.

> ⚠️ При обратном преобразовании некоторые поля, отсутствующие в CSV (например, набор неправильных ответов), создаются пустыми. Это нормально и отражает ограничения исходного файла.

## Что понадобится

1. **Node.js 18 или новее.** Скачать и установить можно с официального сайта <https://nodejs.org/>. Во время установки оставляйте значения по умолчанию.
2. **Сам скрипт.** Его можно получить двумя способами:
   - скачать весь репозиторий (`Code → Download ZIP` на GitHub) и распаковать архив;
   - либо сохранить отдельно файл `tools/plantDataConverter.mjs` и папку `docs` (нужен пример CSV).
3. **Файлы данных.** `PlantData.json`, который вы хотите преобразовать, или CSV в формате `docs/sample.csv`.

## Подготовка рабочего каталога

1. Создайте на компьютере папку, например `GuessThePlant`.
2. Скопируйте в неё:
   - файл `plantDataConverter.mjs` (оставьте его внутри подпапки `tools` — так команды ниже будут работать без изменений);
   - при необходимости — исходный `PlantData.json` или CSV;
   - файл-пример `docs/sample.csv` (по нему можно сверяться с форматированием колонок).

После распаковки структура может выглядеть так:

```
GuessThePlant/
├── tools/
│   └── plantDataConverter.mjs
├── docs/
│   └── sample.csv
└── ваши файлы данных
```

## Как открыть терминал

- **Windows:** нажмите `Win` → введите «Командная строка» или «PowerShell» → откройте найденное приложение.
- **macOS:** откройте Spotlight (`Cmd + Space`), наберите «Terminal» и запустите программу.
- **Linux:** используйте любимый терминал (например, `Ctrl + Alt + T`).

Перейдите в папку с конвертером. Пример для Windows:

```powershell
cd C:\Users\Имя\Downloads\GuessThePlant
```

Для macOS/Linux команда будет похожей:

```bash
cd ~/Downloads/GuessThePlant
```

## Преобразование PlantData.json → CSV

1. Убедитесь, что файл `PlantData.json` лежит в текущей папке.
2. Выполните команду:

   ```bash
   node tools/plantDataConverter.mjs to-csv --input src/data/json/PlantData.json --output PlantData.csv
   ```

   - `--input` — путь к исходному JSON (может быть относительным или абсолютным).
   - `--output` — имя результирующего CSV.

3. После завершения в консоли появится сообщение вида `Converted 200 plants to CSV: PlantData.csv`. Новый файл можно открыть в Excel, LibreOffice Calc или Google Sheets. Если программа спрашивает разделитель, выберите «запятая» (comma).

## Преобразование CSV → PlantData.json

1. Подготовьте CSV в формате, аналогичном `docs/sample.csv`. Важно сохранять заголовок колонок и расставлять кавычки вокруг значений, содержащих запятые.
2. Запустите команду:

   ```bash
   node tools/plantDataConverter.mjs to-json --input PlantData.csv --output PlantData.json
   ```

3. В результате появится новый `PlantData.json`. Его можно проверить, открыв в текстовом редакторе. Файл уже отформатирован и готов к дальнейшему использованию.

## Формат столбцов CSV

| Столбец | Что нужно указать |
| --- | --- |
| `id` | Номер растения (можно использовать числа или строковые идентификаторы). |
| `(ru)`, `(en)`, `(nl)` | Названия растения на соответствующих языках. Пустая ячейка оставит значение пустым. |
| `(sci)` | Научное название. |
| `images` | Количество изображений (заполняется автоматически при экспорте, можно оставить пустым при импорте — скрипт посчитает по списку ID). |
| `ID изображений` | Список идентификаторов изображений через запятую (например, `p5_1, p5_2`). |
| `Названия файлов` | Список имён файлов изображений (без пути или с префиксом `images/`). |
| `Сложность` | Базовая сложность (`Easy`, `Medium`, `Hard`). Если ячейка пуста, уровень сложности не назначается. |
| `Переопределения сложности` | Список переопределений сложности для конкретных изображений в формате `imageId:Уровень` через запятую (например, `p5_2:Hard, p5_3:Hard`). |
| `Family` | Название ботанического семейства. |

## Проверка результатов

- Запустите `node tools/plantDataConverter.mjs to-csv ...` и затем `to-json` на получившемся CSV — так вы убедитесь, что формат соответствует ожиданиям.
- Если команда завершилась с ошибкой, внимательно прочитайте сообщение (скрипт указывает строку и причину, например несоответствие количества `imageId` и файлов).

## Частые вопросы

- **Нужно ли редактировать колонку `images` вручную?** Нет. Это вспомогательное поле, скрипт пересчитывает количество по списку `ID`.
- **Что делать, если у изображения другой путь?** В колонке файлов допускаются как чистые имена (`Rose.JPG`), так и полный путь с префиксом `images/`. Скрипт автоматически добавит префикс при необходимости.
- **Можно ли работать в Excel?** Да. Главное — сохранить CSV в кодировке UTF-8 и включить кавычки вокруг ячеек с запятыми. Большинство таблиц делает это автоматически при стандартном сохранении в CSV.
- **Нужно ли ставить кавычки вокруг ID?** Нет. Можно писать `p202` или `p202_1` без дополнительных символов — конвертер сам убирает лишние кавычки и сохраняет идентификаторы в нужном виде.
- **Что будет, если сложность оставить пустой?** В JSON не появится запись об уровне сложности для этого растения, и игра обработает его как элемент без назначенной сложности. При наличии переопределений укажите их в колонке `Переопределения сложности`, даже если базовое поле пустое.

## Устранение неполадок

| Сообщение об ошибке | Что проверить |
| --- | --- |
| `Не указан идентификатор растения…` | В строке пропущено значение в колонке `id`. |
| `Количество imageId и файлов не совпадает…` | В строке разное количество элементов в списках `ID` и имён файлов. |
| `Неизвестная команда` | Опечатка в подкоманде (`to-csv` или `to-json`). |

Если вопросы остались, откройте файл `docs/sample.csv` как пример и сравните с вашим CSV.

Успешной работы с данными! 🌱
